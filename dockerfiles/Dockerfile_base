# Use micromamba base image (very slim and Conda-compatible)
FROM docker.io/mambaorg/micromamba:1.5.6

# Metadata
LABEL base.image="mambaorg/micromamba:1.5.6"
LABEL software="EPITOME"
LABEL software.version="v1.6.0"
LABEL description="Dependencies for the EPITOME pipeline using micromamba"
LABEL website="https://github.com/DOH-JDJ0303/epitome"
LABEL license="Apache 2.0"
LABEL maintainer="Jared Johnson"
LABEL maintainer.email="jared.johnson@doh.wa.gov"

USER root

# Set environment and shell
ENV MAMBA_ROOT_PREFIX=/opt/conda \
    PATH=/opt/conda/bin:$PATH \
    DEBIAN_FRONTEND=noninteractive

# Create environment and install sourmash + R
RUN micromamba install -y -n base \
    -c conda-forge -c bioconda \
    sourmash \
    r-base=4.4.2 \
    r-recommended \
    scikit-learn \
    && micromamba clean --all --yes

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    procps \
    jq \
    gawk

# Optionally test install
RUN sourmash --version && R --version